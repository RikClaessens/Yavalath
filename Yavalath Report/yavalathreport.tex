% !TEX root = yavalathreport.tex
%!%TEX program = xelatex
\documentclass[11pt]{article}

	\input{settings/settings.tex}

\begin{document}

\title{{\Huge Yavalath} \\ \vspace{0.5em}{\large August 2014 - Intelligent Search \& Games\\ Master Artificial Intelligence, Maastricht University}}	
\author{Rik Claessens}

\maketitle

\begin{abstract}
Yavalath is a board game created by a computer program called Ludi. This paper describes a Alpha-Beta implementation for the game of Yavalath. A number of enhancements over the vanilla $\alpha \beta$-framework and their impact on game playing performance is evaluated.
\end{abstract}

\section{The Game of Yavalath}
\label{-sec:thegameofyavalath}
Yavalath is played on board made up of a hexagonal grid of 61 cells. It is the first commercial board game that was generated by a computer program. This general game system is called Ludi and was created by Cameron Browne. The rules of Yavalath are defined in the \ac{GDL} as presented in Listing \ref{lst:yavalathgdl}. 

\listingspace
\begin{lstlisting}[caption={The Yavalath definition in GDL}]
(game Yavalath
	(players White Black)
	(board (tiling hex) (shape hex) (size 5))
	(pieces (Piece All (moves (move (pre (empty to))
		(action (push)))))) 
	(end
		(All win (in-a-row 4))
		(All lose (and (in-a-row 3) (not (in-a-row 4))))
	)
)
\end{lstlisting}
\label{lst:yavalathgdl}
\listingspace

As the game is defined in just these few lines, the rules are very straightforward. The game is played with 2 player, White and Black and is played on a hexagonal shaped board of size 5 (Figure \ref{fig:emptyboard}). Allowed moves consist of placing a stone on one of the free cells remaining on the board. A player wins if he completes a line of four but loses if he completes a line of three before. The commonly used swap rule is also used in Yavalath in order to avoid a too strong opening move option for White. 

\input{figures/emptyboard.tex}

One of the key aspects of Yavalath is the forcing move. When a player has - in any direction - a line consisting of one stone of his color, one free cell and then another two stone of his color, he forces his opponent to play a forced move. This is shown in Figure \ref{fig:forcedmoves}. By playing the move marked 1, White forces Black to play move 2 (forced moves are labeled in red), thereby forcing Black to create a line of three, which means that Black will lose. This mechanic will prove essential for the developed agent as by using forced moves it is possible to limit your opponents options and in a way controlling where he is able to make his next move.

\input{figures/forcedmoves.tex}

Its simple set of rules and the unique winning condition is what Yavalath is most famous for and what made it one of the most popular board games on the website \url{www.boardgamegeek.com}. The game could also be played with three players where the only difference is that a player that makes a line of three leaves the game, after which the game is continued until a player wins by creating a line of four or by being the only remaining in the game. Furthermore, the active player is required to play any moves that would be part of a line of four if the part of a line of four during a subsequent move of the player that has this position.

\section{Evaluation Function}
\label{-sec:evaluationfunction}

Crucial for any AI player is a well-performing evaluation function. We discuss the Yavalath evaluation function according to seven principles as presented in \cite{Winands2004}. These seven principles include: \begin{enumerate*}\item threats, \item solid formations, \item mobility, \item blocking, \item centralisation, \item material advantage and \item initiative\end{enumerate*}.

\subsection{Win or Loss}
\label{-subsec:winorloss}
First of all, if a board is a win or loss for the player, the evaluation of the board is given by:
\begin{equation}\label{eq:winscore}
score = \twopartdef{\phantom{-}WIN\ SCORE - \#\ of\ moves\ made}{\mbox{the position is a WIN}}{-WIN\ SCORE + \#\ of\ moves\ made}{\mbox{the position is a LOSS.}}
\end{equation}

With this game over evaluation score, we take into account the depth at which a win or loss was found. Obviously, obtaining a win sooner and delaying a loss as long as possible is preferable, so we subtract or add the number of moves made to the $WIN\ SCORE$ and the negative $WIN\ SCORE$ respectively.

\subsection{Inapplicable evaluation function features}
\label{-subsec:inapplicableevaluationfunctionfeatures}
First we describe the features that are inapplicable for Yavalath and why that is the case.

\subsubsection{Mobility}
\label{-subsubsec:mobility}
As there are no restrictions where a player is able to move and pieces are not moved across the board, but instead placed at empty squares, mobility does not play a role in Yavalath.

\subsubsection{Material Advantage}
\label{-subsubsec:materialadvantage}
Another feature that is in inapplicable for Yavalath is material advantage. This is the case because pieces cannot be captured by other players. Therefore, the number of pieces on the board is equal to the number of moves made thus far and all players will have the same number of pieces on the board after each complete game round.

\subsection{Threats}
\label{-subsec:threats}
A returning aspect of Yavalath is forcing your opponent to make certain moves. In this way one is able to limit his opponents options. A formation that could lead to a forced move for the player can therefore be seen as a threat. This is the case when in any straight line of four fields, there are three pieces of the opponent's color and one free field in between (Figure \ref{fig:threat}).

\input{figures/threat.tex}



\subsection{Solid Formations}
\label{-subsec:solidformations}
There are a number of solid formations in the game of Yavalath. Forcing the opponent to make certain moves is a crucial aspect of Yavalath and it also place a strong role in determining strong formations. A number of these formations are described in \cite{browne2011evolutionary} and are shown in Figure \ref{fig:solidformations}. These triangles each form a basis on which White can force Black to play certain moves and, if Black fails to block the position in a proper way, will lead to a win for White.

\input{figures/solidformations.tex}

The strength of these triangle formation lies in the fact that they can be applied in three \emph{directions of play} and two \emph{rotations of play}. What we mean with this is that the first move can be played along one of three sides of the triangle as well as 2 rotations of the triangle.

In addition to the formations presented in \cite{browne2011evolutionary} (Figure \ref{fig:solidformations}), we would like to add several combinations of these triangles of size 2, 3 and 4. These formations, along with the winning move sequence are presented in Figure \ref{fig:additionalsolidformations}.

\input{figures/additionalsolidformations.tex}

These additional formations do not have the advantage that they can be played in any direction like the formations in Figure \ref{fig:solidformations}. However, it is clear that formations that can be used to force the opponent to move are crucial in Yavalath.

\subsection{Centralisation}
\label{-subsec:centralisation}
Another part of the evaluation function for the game of Yavalath is centralisation. The intuition behind this feature is that playing near the center of the board gives the player more options to choose from, \ie more directions to play in. Therefore we give all fields a score, based on the distance to the edge of the board. These distances are shown in Figure \ref{fig:scores}. 

\input{figures/scores.tex}

The centralisation score is then defined as:

\begin{equation}
	centralisation\ score = distance \mydot distance\ score,
\end{equation}

where we set $distance\ score = 200$.

However, because of the swap rule, we remove the bonus for the central two hexagonal circles (all fields with distances of $4$ or $5$) for the first move if the AI player is White. This is to prevent the player from playing a move that will very likely be swapped during Black's first move anyway, thereby losing his first move advantage.

\subsection{Initiative}
\label{-subsec:initiative}
The last evaluation function principle proposed by \cite{Winands2004} is initiative. Obtaining the initiative in the game of Yavalath is useful for forcing moves by the opponent, thereby limiting his options and with that his ability to force moves for the AI player. Because of this the sooner, a move can be forced by the AI player, the better.

\section{\texorpdfstring{$\boldsymbol{\alpha\beta}$}{alphabeta}-enhancements}
\label{-sec:alphabeta-enhancements}%fixed
In this section we describe a number of enhancements made to the general $\alpha\beta$-framework. These include \begin{enumerate*}\item move ordering, \item a transposition table, \item killer moves, \item null moves, \item quiescence search and \item the relative history heuristic\end{enumerate*}
As a first remark, although the AI player will not participate in a tournament, it still makes use of iterative deepening in order to stay as close as possible to an AI player that could be used in a real game or tournament. Iterative deepening performs the same $\alpha\beta$-search for increasing depth, starting at depth $1$. The costs of the repeated search can be compensated by using a number of enhancements to increase the number of $\alpha\beta$-cutoffs when searching at increased depths, especially when using a transposition table.

\subsection{Transposition Table}
\label{-subsec:transpositiontable}
In games where it is possible to obtain the same board position after different move sequences, it is possible to use a transposition table to speed up the search. This speed-up is achieved by storing already evaluated positions, along with the obtained value and the depth at which the position was evaluated. Then, when the position appears again while traversing the tree, the previously obtained result can be used if the remaining search depth is equal or smaller for the current position.

For this, a set of $3\times 61$ random numbers is used to create a zobirst hash-value for a position. This hash is used to store and retrieve a transposition.

\subsection{Null Moves}
\label{-subsec:nullmoves}
The idea of null moves is that any position on which a player is able to forfeit a move and remains a strong position, will be an even stronger position when he would have made a move. In Yavalath, we do not allow null moves when a player is forced to make a move. Furthermore, we do not allow two consecutive null moves as this would allow the opponent in a lot of situations to create positions that leads to forced moves by the player. This does not help the search as it gives a overly pessimistic evaluation of the position under consideration.

\subsection{Relative History Heuristic}
\label{-subsec:relativehistoryheuristic}
Instead of a static move ordering, the relative history heuristic can be used. Simply said, the heuristic increases the score of each move that has produced a cut off and the number of times it didn't. The relative history heuristic now defines the score of a move as:

\begin{equation}
	move\ score = \frac{hh\ score}{bf\ score},
\end{equation}

where the $hh\ score$ is the history heuristic score and $bf\ score$ is the butterfly score \cite{Winands2004}. As suggested in the same thesis, the $hh\ score$ and $bf\ score$ are both incremented by one in case of a cut-off and no cut-off respectively. This move ordering is used after the killer move and transposition table move have been evaluated.

\subsection{Move ordering}
\label{-subsec:moveordering}
Before moves are evaluated at a certain depth, the allowed moves are sorted. The goal of this move ordering is to achieve an $\alpha\beta$-cutoff as soon as possible. The sooner a cutoff is achieved, the more the search is sped up. Several techniques suggest good moves to try first at a certain depth, killer moves, principal variation moves from previous searches and transposition tables. Generally, null moves are tried first if they are allowed. Then, as this gives us the most reliable information, the retrieved move from the transposition table is performed, then the principal variation of the last iteration and finally the killer moves are played. Then the relative history heuristic can sort the remaining moves based on the number of times they appeared in the search. However, a static move ordering is used if this feature is disabled. This static move ordering is shown in Figure \ref{fig:staticmoveordering}.

\input{figures/moveordering.tex}

Moves are considered in an outwards spiraling order, as playing near the center gives the player most opportunities to create strong positions.

\section{Acknowledgments}
\label{-sec:acknowledgments}


For displaying the board an existing display engine was used, published on Github by user silverio (\url{https://github.com/silverio/samples}).

	\nocite{*}
	\printbibliography
	\Numbering{Roman}{1}

\end{document}